<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your Invoices</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .status-badge {
      font-size: 0.85rem;
      padding: 0.4rem 0.8rem;
      border-radius: 4px;
    }
    .status-pending { background-color: #ffc107; color: black; }
    .status-packed { background-color: #17a2b8; color: white; }
    .status-delivering { background-color: #0275d8; color: white; }
    .status-delivered { background-color: #28a745; color: white; }
    .status-refunded { background-color: #dc3545; color: white; }
    .status-refund-pending { background-color: #ff9800; color: white; }
    .status-refund-accepted { background-color: #4caf50; color: white; }
    .status-refund-rejected { background-color: #f44336; color: white; }
  </style>
</head>

<body>

<!-- NAVBAR -->
<%- include('partials/navbar') %>

<div class="container mt-5">
  <h2 class="text-center mb-4">Your Invoices</h2>

  <table class="table table-bordered table-striped text-center align-middle">
    <thead class="table-dark">
      <tr>
        <th>Order ID</th>
        <th>Total</th>
        <th>Date</th>
        <th>Status</th>
        <th>View</th>
      </tr>
    </thead>

    <tbody>
      <% orders.forEach(o => { %>
        <tr>
          <td><%= o.id %></td>
          <td>$<%= Number(o.total).toFixed(2) %></td>
          <td><%= o.createdAt.toLocaleString() %></td>
          <td>
            <% 
              let displayStatus = o.status || 'Pending';
              let statusClass = '';
              
              // Check if there's a refund concern
              if (o.refundStatus === 'Pending') {
                displayStatus = 'Refund Pending';
                statusClass = 'status-refund-pending';
              } else if (o.refundStatus === 'Approved') {
                displayStatus = 'Refund Accepted';
                statusClass = 'status-refund-accepted';
              } else if (o.refundStatus === 'Rejected') {
                displayStatus = 'Refund Invalid';
                statusClass = 'status-refund-invalid';
              } else {
                // Normal order statuses
                if (o.status === 'Pending') { statusClass = 'status-pending'; }
                else if (o.status === 'Packed') { statusClass = 'status-packed'; }
                else if (o.status === 'Out for Delivery') { statusClass = 'status-delivering'; }
                else if (o.status === 'Delivered') { statusClass = 'status-delivered'; }
                else if (o.status === 'Refunded') { statusClass = 'status-refunded'; }
              }
            %>
            <span class="status-badge <%= statusClass %>"><%= displayStatus %></span>
          </td>
          <td>
            <a class="btn btn-primary btn-sm" href="/invoice/<%= o.id %>">
              View
            </a>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
